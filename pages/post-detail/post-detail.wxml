<!--pages/post-detail/post-detail.wxml - IEClub ä¸»é¢˜è®¾è®¡-->
<view class="container">

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å¸–å­å†…å®¹ -->
  <view class="post-detail card" wx:if="{{post && !loading}}">

    <!-- å¸–å­å¤´éƒ¨ -->
    <view class="post-header flex-between">
      <view class="post-user flex-center">
        <image class="post-avatar" src="{{post.userAvatar}}" mode="aspectFill" />
        <view class="post-author-info">
          <text class="post-author">{{post.username}}</text>
        </view>
      </view>
      <text class="post-meta">{{post.createdAt}}</text>
    </view>

    <!-- å¸–å­å†…å®¹ -->
    <view class="post-content">
      <text class="post-text">{{post.content}}</text>

      <!-- å›¾ç‰‡å±•ç¤º -->
      <view class="post-images" wx:if="{{post.images && post.images.length > 0}}">
        <view class="image-grid">
          <image
            wx:for="{{post.images}}"
            wx:key="*this"
            class="post-image"
            src="{{item}}"
            mode="aspectFill"
            bindtap="previewImage"
            data-current="{{item}}"
            data-urls="{{post.images}}"
          />
        </view>
      </view>
    </view>

    <!-- å¸–å­æ“ä½œ -->
    <view class="post-actions">
      <view class="post-action-btn flex-center" bindtap="likePost">
        <text class="iconfont {{post.isLiked ? 'icon-liked' : 'icon-like'}}">
          {{post.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}
        </text>
        <text class="action-count">{{post.likeCount || 0}}</text>
      </view>
    </view>
  </view>

  <!-- è¯„è®ºåŒºåŸŸ -->
  <view class="comments-section card" wx:if="{{post && !loading}}">
    <view class="section-header gradient-primary flex-between">
      <text class="section-title">ğŸ’¬ è¯„è®º ({{comments.length}})</text>
      <view class="add-comment-btn" bindtap="showCommentBox">
        <text>âœï¸ å†™è¯„è®º</text>
      </view>
    </view>

    <!-- è¯„è®ºè¾“å…¥æ¡† -->
    <view class="comment-input-area" wx:if="{{showCommentInput}}">
      <view class="input-container">
        <input
          class="comment-input input-field"
          placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."
          value="{{commentContent}}"
          bindinput="onCommentInput"
          adjust-position="{{true}}"
          hold-keyboard="{{true}}"
        />
        <view class="input-actions flex-between">
          <button class="cancel-btn btn-outline-blue btn-small" bindtap="hideCommentBox">å–æ¶ˆ</button>
          <button class="submit-btn btn-primary btn-small" bindtap="submitComment">å‘è¡¨</button>
        </view>
      </view>
    </view>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <view class="comments-list">
      <view
        class="comment-item"
        wx:for="{{comments}}"
        wx:key="id"
      >
        <view class="comment-header flex-center">
          <image class="comment-avatar" src="{{item.userAvatar}}" mode="aspectFill" />
          <view class="comment-user-info">
            <text class="comment-username">{{item.username}}</text>
            <text class="comment-time">{{item.createdAt}}</text>
          </view>
        </view>
        <view class="comment-content">
          <text class="comment-text">{{item.content}}</text>
        </view>
      </view>

      <!-- ç©ºè¯„è®ºæç¤º -->
      <view class="no-comments empty-state" wx:if="{{comments.length === 0}}">
        <view class="empty-icon">ğŸ’¬</view>
        <text class="empty-text">è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§~</text>
      </view>
    </view>
  </view>

</view>